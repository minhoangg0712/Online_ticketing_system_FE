<div class="event-container">
  <div *ngIf="pendingEvents.length === 0" class="no-events">
    <p>Không có sự kiện sắp chờ duyệt.</p>
  </div>

  <div class="event-list">
    <div class="event-card" *ngFor="let event of pendingEvents">
      <div class="images-container">
        <img [src]="event.logoUrl" alt="Logo" class="event-logo" />
      </div>
      <div class="event-details">
        <h3 class="event-name">{{ event.eventName }}</h3>
        <p class="event-info"><span class="label">Bắt đầu:</span> {{ event.startTime | date:'dd/MM/yyyy, HH:mm' }}</p>
        <p class="event-info"><span class="label">Kết thúc:</span> {{ event.endTime | date:'dd/MM/yyyy, HH:mm' }}</p>
        <p class="event-info"><span class="label">Trạng thái:</span>
          <span class="status" [ngClass]="{
            'status-approved': event.approvalStatus === 'approved',
            'status-pending': event.approvalStatus === 'pending',
            'status-rejected': event.approvalStatus === 'rejected'
          }">{{ event.approvalStatus | statusTranslate }}</span>
        </p>
      </div>
      <div class="event-actions">
        <button class="btn btn-view" (click)="openDetail(event)">Xem chi tiết</button>
      </div>
    </div>
  </div>

  <div class="event-detail-modal" *ngIf="selectedEvent">
    <div class="modal-content">
      <span class="close-button" (click)="closeDetail()">&times;</span>
      <div *ngIf="!isEditing">
        <h2>{{ selectedEvent.eventName }}</h2>
        <div class="modal-images">
          <img *ngIf="selectedEvent.logoUrl" [src]="selectedEvent.logoUrl" alt="Logo" class="modal-logo" />
          <img *ngIf="selectedEvent.backgroundUrl" [src]="selectedEvent.backgroundUrl" alt="Background" class="modal-background" />
        </div>
        <p><strong>Thời gian:</strong> {{ selectedEvent.startTime | date:'dd/MM/yyyy, HH:mm' }} - {{ selectedEvent.endTime | date:'dd/MM/yyyy, HH:mm' }}</p>
        <p><strong>Địa điểm:</strong> {{ selectedEvent.address }}</p>
        <p><strong>Danh mục:</strong> {{ selectedEvent.category }}</p>
        <p><strong>Mô tả:</strong> {{ selectedEvent.description }}</p>
        <p><strong>Trạng thái:</strong> {{ selectedEvent.approvalStatus | statusTranslate }}</p>
        <p *ngIf="selectedEvent.approvalStatus === 'rejected' && selectedEvent.rejectReason">
          <strong>Lý do từ chối:</strong> {{ selectedEvent.rejectReason }}
        </p>
        <div class="ticket-prices" *ngIf="selectedEvent.ticketPrices">
          <p *ngIf="ticketPriceList.length">
            <strong>Giá vé:</strong>
          </p>
          <ul class="ticket-price">
            <li *ngFor="let ticket of ticketPriceList">
              <span class="label">{{ ticket.type }}:</span> {{ ticket.price | number:'1.0-0' }} VND
            </li>
          </ul>
        </div>
        <div class="modal-actions">
          <button class="btn btn-edit" (click)="toggleEdit()">Chỉnh sửa</button>
        </div>
      </div>

      <div *ngIf="isEditing">
        <form [formGroup]="eventForm" (ngSubmit)="saveChanges()">
          <h2>Chỉnh sửa sự kiện</h2>

          <div class="form-group">
            <label>Tên sự kiện</label>
            <input formControlName="eventName" type="text" class="form-control" placeholder="Nhập tên sự kiện" />
          </div>

          <div class="form-group">
            <label>Thời gian bắt đầu</label>
            <input formControlName="startTime" type="datetime-local" class="form-control" />
          </div>

          <div class="form-group">
            <label>Thời gian kết thúc</label>
            <input formControlName="endTime" type="datetime-local" class="form-control" />
          </div>

          <div class="form-group">
            <label for="addressName">Tên địa điểm</label>
            <input id="addressName" formControlName="addressName" type="text" class="form-control" placeholder="Tên địa điểm" />
          </div>
          <div class="form-group">
            <label for="provinces">Tỉnh/Thành</label>
            <select id="provinces" formControlName="provinces" class="form-control">
              <option value="" disabled selected hidden>Chọn Tỉnh/Thành</option>
              <option *ngFor="let province of selectedEvent.provinceList" [value]="province.id">{{ province.name }}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="districts">Quận/Huyện</label>
            <select id="districts" formControlName="districts" class="form-control">
              <option value="" disabled selected hidden>Chọn Quận/Huyện</option>
              <option *ngFor="let district of selectedEvent.districtList" [value]="district.id">{{ district.name }}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="wardId">Phường/Xã</label>
            <select id="wardId" formControlName="wardId" class="form-control">
              <option value="" disabled selected hidden>Chọn Phường/Xã</option>
              <option *ngFor="let ward of selectedEvent.wardList" [value]="ward.id">{{ ward.name }}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="addressDetail">Số nhà, đường</label>
            <input id="addressDetail" formControlName="addressDetail" type="text" class="form-control" placeholder="Số nhà, đường" />
          </div>

          <div class="form-group">
            <label>Danh mục</label>
            <select formControlName="category" class="form-control">
              <option value="Music">Âm nhạc</option>
              <option value="Theatre-Arts">Sân khấu & nghệ thuật</option>
              <option value="Workshop">Workshop</option>
              <option value="Sport">Thể thao</option>
              <option value="Other">Khác</option>
            </select>
          </div>

          <div class="form-group">
            <label>Mô tả</label>
            <textarea formControlName="description" class="form-control" rows="5" placeholder="Mô tả sự kiện"></textarea>
          </div>

          <div class="form-group">
            <label>Logo sự kiện</label>
            <input type="file" (change)="onFileSelected($event, 'logo')" class="form-control" />
            <div *ngIf="logoPreview" class="preview-image">
              <img [src]="logoPreview" alt="Logo Preview" />
            </div>
          </div>

          <div class="form-group">
            <label>Ảnh bìa sự kiện</label>
            <input type="file" (change)="onFileSelected($event, 'background')" class="form-control" />
            <div *ngIf="backgroundPreview" class="preview-image">
              <img [src]="backgroundPreview" alt="Background Preview" />
            </div>
          </div>

          <div class="modal-actions">
            <button type="submit" class="btn btn-save" [disabled]="eventForm.invalid">Lưu thay đổi</button>
            <button type="button" class="btn btn-cancel" (click)="toggleEdit()">Hủy</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>